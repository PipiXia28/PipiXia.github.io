<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Mysql8.0修改密码端口,限制ip连接</title>
      <link href="post/8f24.html"/>
      <url>post/8f24.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>之前在云服务器上装了一个<code>Mysql</code>自用，结果有一天登录发现数据库被黑了<br>当初搭环境时想到没什么重要数据，端口和账号密码都是默认的，吃了亏之后决定对数据库连接进行限制</p></blockquote><a id="more"></a><h4 id="证据如下"><a href="#证据如下" class="headerlink" title="证据如下"></a>证据如下</h4><p>我连接上数据库时，发现所有库里的表都被删除,只剩下一张<code>warning</code>表，里面有下图的提示语，需要登录交钱的网站和对应的<code>token</code><br><img src="https://s1.ax1x.com/2020/10/20/BSzRBR.jpg" class="lazyload placeholder" data-srcset="https://s1.ax1x.com/2020/10/20/BSzRBR.jpg" srcset="https://cdn.jsdelivr.net/gh/XuxuGood/cdn@master/blogImages/site-img/loading3.gif" alt="数据库内留言"><br>当我把比特币汇率算了下钱，emmmmmmmmmm，可太看的起我了，服务器就才花了几十块钱，坚决不交，不能助长苗头(主要数据库里没啥重要数据)，于是痛下决心花点时间将数据库连接进行一下限制<br><img src="https://s1.ax1x.com/2020/10/20/BSzWH1.jpg" class="lazyload placeholder" data-srcset="https://s1.ax1x.com/2020/10/20/BSzWH1.jpg" srcset="https://cdn.jsdelivr.net/gh/XuxuGood/cdn@master/blogImages/site-img/loading3.gif" alt="需要交纳的比特币"><br><img src="https://s1.ax1x.com/2020/10/20/BSz2u9.jpg" class="lazyload placeholder" data-srcset="https://s1.ax1x.com/2020/10/20/BSz2u9.jpg" srcset="https://cdn.jsdelivr.net/gh/XuxuGood/cdn@master/blogImages/site-img/loading3.gif" alt="折合成毛爷爷"></p><h4 id="修改端口"><a href="#修改端口" class="headerlink" title="修改端口"></a>修改端口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#先连接数据库，输入密码登录</span><br><span class="line">[root@VM-0-4-centos &#x2F;]# mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">#查看端口 默认为3306</span><br><span class="line">mysql&gt; show global variables like &#39;port&#39;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| port          | 3306 |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.13 sec)</span><br><span class="line">#修改配置文件</span><br><span class="line">[root@VM-0-4-centos etc]# vim &#x2F;etc&#x2F;my.cnf</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">#默认端口 </span><br><span class="line">port&#x3D;3306 </span><br><span class="line">datadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock</span><br><span class="line">#如果忘记了密码 可以加上下面这句 重启mysql即可免密码登录</span><br><span class="line">#skip-grant-tables</span><br><span class="line"></span><br><span class="line">log-error&#x3D;&#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class="line">pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid</span><br><span class="line"></span><br><span class="line">#重启mysql</span><br><span class="line">[root@VM-0-4-centos etc]# service mysqld restart</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="查看账号对应ip"><a href="#查看账号对应ip" class="headerlink" title="查看账号对应ip"></a>查看账号对应ip</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-4-centos &#x2F;]# mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line"># 查询账号和对应的ip</span><br><span class="line">mysql&gt; select user,host from user;</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">| user             | host            |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">| mysqlbackups     | %               |</span><br><span class="line">| root             | %   |</span><br><span class="line">| mysql.infoschema | localhost       |</span><br><span class="line">| mysql.session    | localhost       |</span><br><span class="line">| mysql.sys        | localhost       |</span><br><span class="line">| root             | localhost       |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>可以看见root有一个<code>localhost</code>和<code>%</code>,<code>%</code>就代表<code>ip</code>没有限制可以任意连接，这当然不是我们想要的，接下来创建账号和对应的<code>ip</code></p><h4 id="创建账号"><a href="#创建账号" class="headerlink" title="创建账号"></a>创建账号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#创建对应ip的账号</span><br><span class="line">mysql&gt; CREATE USER &#39;root&#39;@&#39;11.22.33.44&#39; IDENTIFIED WITH mysql_native_password BY &#39;password&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"></span><br><span class="line">#刷新配置</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select user,host from user;</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">| user             | host            |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">| mysqlbackups     | %               |</span><br><span class="line">| root             | %       |</span><br><span class="line">| root             | 11.22.33.44     |</span><br><span class="line">| mysql.infoschema | localhost       |</span><br><span class="line">| mysql.session    | localhost       |</span><br><span class="line">| mysql.sys        | localhost       |</span><br><span class="line">| root             | localhost       |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看见已经多了一个新的ip，记得查看自己的<a href="https://www.baidu.com/s?ie=UTF-8&wd=ip">ip</a>，加到配置中去，然后删除默认的<code>%</code></p><h5 id="删除ip对应的账号"><a href="#删除ip对应的账号" class="headerlink" title="删除ip对应的账号"></a>删除ip对应的账号</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; drop user&#39;root&#39;@&#39;%&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.08 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure><h5 id="修改账号权限"><a href="#修改账号权限" class="headerlink" title="修改账号权限"></a>修改账号权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#查询权限</span><br><span class="line">mysql&gt; select user,host,grant_priv,super_priv from user;</span><br><span class="line">+------------------+-----------------+------------+------------+</span><br><span class="line">| user             | host            | grant_priv | super_priv |</span><br><span class="line">+------------------+-----------------+------------+------------+</span><br><span class="line">| mysqlbackups     | %               | N          | N          |</span><br><span class="line">| root             | 11.22.33.44     | N          | N          |</span><br><span class="line">| mysql.infoschema | localhost       | N          | N          |</span><br><span class="line">| mysql.session    | localhost       | N          | Y          |</span><br><span class="line">| mysql.sys        | localhost       | N          | N          |</span><br><span class="line">| root             | localhost       | Y          | Y          |</span><br><span class="line">+------------------+-----------------+------------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">#将root账号对应的权限修改为yes</span><br><span class="line">mysql&gt; UPDATE mysql.user SET Grant_priv&#x3D;&#39;Y&#39;, Super_priv&#x3D;&#39;Y&#39; WHERE User&#x3D;&#39;root&#39;;</span><br><span class="line">Query OK, 1 row affected (0.08 sec)</span><br><span class="line">Rows matched: 8  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">#再次查询权限已经更新</span><br><span class="line">mysql&gt; select user,host,grant_priv,super_priv from user;</span><br><span class="line">+------------------+-----------------+------------+------------+</span><br><span class="line">| user             | host            | grant_priv | super_priv |</span><br><span class="line">+------------------+-----------------+------------+------------+</span><br><span class="line">| mysqlbackups     | %               | N          | N          |</span><br><span class="line">| root             | 11.22.33.44     | Y          | Y          |</span><br><span class="line">| mysql.infoschema | localhost       | N          | N          |</span><br><span class="line">| mysql.session    | localhost       | N          | Y          |</span><br><span class="line">| mysql.sys        | localhost       | N          | N          |</span><br><span class="line">| root             | localhost       | Y          | Y          |</span><br><span class="line">+------------------+-----------------+------------+------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>如果连接之后发现无法看见创建的数据库，只有一个数据库，如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">#将对应数据库的权限加上</span><br><span class="line">mysql&gt; grant all privileges on databasename.* to &#39;root&#39;@&#39;11.22.33.44&#39;;</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure><h4 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;password&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br></pre></td></tr></table></figure><p>改完之后重新退出登录即可</p><p>通过改端口和限制<code>ip</code>，修改密码，将数据库的安全性比以前提高了很多(在被黑当我没说)，希望大家引以为戒，☁️服务器的相关配置都要好好设置</p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo-pm2后台运行</title>
      <link href="post/67f5.html"/>
      <url>post/67f5.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>为什么需要<code>pm2</code>后台启动？<br>从启动日志可以看到当<code>ssh</code>窗口关闭或者<code>Ctrl+C</code>时服务就会停止，我们需要安装<code>pm2</code>用于后台运行，当检测到<code>hexo</code>服务停止时会自动重启。</p></blockquote><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-4-centos ~]# hexo s</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http:&#x2F;&#x2F;localhost:4000 . Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure><h5 id="pm2安装"><a href="#pm2安装" class="headerlink" title="pm2安装"></a>pm2安装</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 安装pm2</span><br><span class="line">[root@VM-0-4-centos ~]# npm install -g pm2</span><br><span class="line"># 创建启动js</span><br><span class="line">[root@VM-0-4-centos hexo]# vi hexo-auto.js </span><br></pre></td></tr></table></figure><p><code>hexo-auto.js</code>内容：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec;</span><br><span class="line"><span class="comment">// gulp后面提升加载速度时用到，现在不需要</span></span><br><span class="line"><span class="comment">// -p 8888 指定端口号，可以不加</span></span><br><span class="line"><span class="keyword">var</span> cmd = <span class="string">&#x27;hexo clean &amp;&amp; hexo g &amp;&amp; gulp &amp;&amp; nohup hexo s -p 8888 &gt;&gt; server.log &amp;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">exec(cmd, <span class="function"><span class="keyword">function</span>(<span class="params">error, stdout, stderr</span>) </span>&#123;</span><br><span class="line">  process.exit(<span class="number">0</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>pm2</code>命令用于后台运行，正常测试的时候还是可以使用<code>hexo</code>的几个命令。</p><h5 id="pm2常用命令"><a href="#pm2常用命令" class="headerlink" title="pm2常用命令"></a>pm2常用命令</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 启动</span><br><span class="line">[root@VM-0-4-centos hexo]# pm2 start hexo-auto.js </span><br><span class="line">[PM2] Applying action restartProcessId on app [hexo-auto](ids: [ 1 ])</span><br><span class="line">[PM2] [hexo-auto](1) ✓</span><br><span class="line">[PM2] Process successfully started</span><br></pre></td></tr></table></figure><p>启动效果如下<br><img src="https://s1.ax1x.com/2020/07/14/UNjV7F.jpg" class="lazyload placeholder" data-srcset="https://s1.ax1x.com/2020/07/14/UNjV7F.jpg" srcset="https://cdn.jsdelivr.net/gh/XuxuGood/cdn@master/blogImages/site-img/loading3.gif"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 关闭</span><br><span class="line">[root@VM-0-4-centos hexo]# pm2 stop hexo-auto.js </span><br><span class="line">[PM2] Applying action stopProcessId on app [hexo-auto.js](ids: [ 1 ])</span><br><span class="line">[PM2] [hexo-auto](1) ✓</span><br></pre></td></tr></table></figure><p>关闭效果如下<br><img src="https://s1.ax1x.com/2020/07/14/UNXGJs.png" class="lazyload placeholder" data-srcset="https://s1.ax1x.com/2020/07/14/UNXGJs.png" srcset="https://cdn.jsdelivr.net/gh/XuxuGood/cdn@master/blogImages/site-img/loading3.gif"><br>需要注意，当想要杀掉<code>hexo</code>进程时，要先关闭<code>pm2</code>，否则<code>hexo</code>服务会重启。</p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
          <category> pm2 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> pm2 </tag>
            
            <tag> next </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA创建SpringBoot项目报connect timed out解决方案</title>
      <link href="post/ebe9.html"/>
      <url>post/ebe9.html</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>IDEA</code>用默认的<a href="https://start.spring.io/">https://start.spring.io</a>路径创建<code>SpringBoot</code>项目时由于网络或者其他原因导致连接超时<br>Initialization failed for ‘<a href="https://start.spring.io&/#39;">https://start.spring.io&#39;</a><br>Please check URL, network and proxy settings.<br>Error message:<br>Cannot download ‘<a href="https://start.spring.io&/#39;">https://start.spring.io&#39;</a>: connect timed out</p></blockquote><a id="more"></a><h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><h5 id="切换网络"><a href="#切换网络" class="headerlink" title="切换网络"></a>切换网络</h5><p>如果电脑联接网络有问题的话，可以尝试连接自己的手机热点进行项目创建。这种方法我用台式机没有成功，但是用笔记本成功了，可以参考一下。</p><h5 id="切换数据源-推荐"><a href="#切换数据源-推荐" class="headerlink" title="切换数据源(推荐)"></a>切换数据源(推荐)</h5><p>在创建时点击<code>Custom</code>，在输入框内输入<a href="https://start.aliyun.com/">https://start.aliyun.com/</a>，如下图<br><img src="https://s1.ax1x.com/2020/08/04/a0LPNd.md.png" class="lazyload placeholder" data-srcset="https://s1.ax1x.com/2020/08/04/a0LPNd.md.png" srcset="https://cdn.jsdelivr.net/gh/XuxuGood/cdn@master/blogImages/site-img/loading3.gif"><br>创建项目之后如果<code>maven</code>无法正常下载依赖，可以尝试在<code>maven</code>的<code>settings.xml</code>添加一下内容</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/repositories/central<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这样不管是创建项目还是下载依赖都在国内，速度比较快。</p>]]></content>
      
      
      <categories>
          
          <category> IDEA </category>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDEA </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>腾讯云服务器nginx配置ssl证书</title>
      <link href="post/bc30.html"/>
      <url>post/bc30.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>需要有一个备案的域名。<br>当前服务器的操作系统为 <code>CentOS 7</code>，由于操作系统的版本不同，详细操作步骤略有区别。<br>安装 <code>SSL</code> 证书前，请您在 <code>Nginx</code> 服务器上开启 “443” 端口，避免证书安装后无法启用 <code>HTTPS</code>。</p></blockquote><a id="more"></a><h4 id="验证是否开启443端口"><a href="#验证是否开启443端口" class="headerlink" title="验证是否开启443端口"></a>验证是否开启443端口</h4><h5 id="开启状态"><a href="#开启状态" class="headerlink" title="开启状态"></a>开启状态</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-4-centos ~]# lsof -i:443</span><br><span class="line">COMMAND  PID  USER   FD   TYPE   DEVICE SIZE&#x2F;OFF NODE NAME</span><br><span class="line">nginx   1349 admin   17u  IPv4 13661312      0t0  TCP *:https (LISTEN)</span><br><span class="line">nginx   2129  root   17u  IPv4 13661312      0t0  TCP *:https (LISTEN)</span><br></pre></td></tr></table></figure><h5 id="未开启状态"><a href="#未开启状态" class="headerlink" title="未开启状态"></a>未开启状态</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-4-centos ~]# lsof -i:443</span><br><span class="line">[root@VM-0-4-centos ~]# </span><br></pre></td></tr></table></figure><h4 id="申请SSL证书"><a href="#申请SSL证书" class="headerlink" title="申请SSL证书"></a>申请SSL证书</h4><h5 id="登陆控制台"><a href="#登陆控制台" class="headerlink" title="登陆控制台"></a>登陆控制台</h5><p>找到<code>SSL</code>证书<br><img src="https://s1.ax1x.com/2020/07/21/UI8mqg.md.png" class="lazyload placeholder" data-srcset="https://s1.ax1x.com/2020/07/21/UI8mqg.md.png" srcset="https://cdn.jsdelivr.net/gh/XuxuGood/cdn@master/blogImages/site-img/loading3.gif"></p><h5 id="点击申请证书"><a href="#点击申请证书" class="headerlink" title="点击申请证书"></a>点击申请证书</h5><ul><li>同一主域最多只能申请20张亚洲诚信品牌免费型DV版SSL证书</li><li>有效期为1年<br><img src="https://s1.ax1x.com/2020/07/21/UI8Kaj.png" class="lazyload placeholder" data-srcset="https://s1.ax1x.com/2020/07/21/UI8Kaj.png" srcset="https://cdn.jsdelivr.net/gh/XuxuGood/cdn@master/blogImages/site-img/loading3.gif"></li></ul><h5 id="填写信息"><a href="#填写信息" class="headerlink" title="填写信息"></a>填写信息</h5><p><img src="https://s1.ax1x.com/2020/07/21/UI8uZQ.md.png" class="lazyload placeholder" data-srcset="https://s1.ax1x.com/2020/07/21/UI8uZQ.md.png" srcset="https://cdn.jsdelivr.net/gh/XuxuGood/cdn@master/blogImages/site-img/loading3.gif"></p><h5 id="确认申请"><a href="#确认申请" class="headerlink" title="确认申请"></a>确认申请</h5><p><img src="https://s1.ax1x.com/2020/07/21/UIJAu8.md.png" class="lazyload placeholder" data-srcset="https://s1.ax1x.com/2020/07/21/UIJAu8.md.png" srcset="https://cdn.jsdelivr.net/gh/XuxuGood/cdn@master/blogImages/site-img/loading3.gif"></p><h5 id="等待颁发下载"><a href="#等待颁发下载" class="headerlink" title="等待颁发下载"></a>等待颁发下载</h5><p>一般几分钟就会颁发下来，然后点击下载就行。<br><img src="https://s1.ax1x.com/2020/07/21/UIJg5d.png" class="lazyload placeholder" data-srcset="https://s1.ax1x.com/2020/07/21/UIJg5d.png" srcset="https://cdn.jsdelivr.net/gh/XuxuGood/cdn@master/blogImages/site-img/loading3.gif"></p><h5 id="解压-上传"><a href="#解压-上传" class="headerlink" title="解压 上传"></a>解压 上传</h5><p>解压后有个<code>Nginx</code>的文件夹，里面有申请的对应域名的证书，将这两个文件上传到服务器安装<code>Nginx</code>的<code>conf</code>目录里。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-4-centos ~]# cd &#x2F;home&#x2F;admin&#x2F;nginx&#x2F;conf&#x2F;</span><br><span class="line">[root@VM-0-4-centos conf]# ll</span><br><span class="line">-rw-r--r-- 1 root root 3747 Jul 12 20:12 1_blog.ppxhq.top_bundle.crt</span><br><span class="line">-rw-r--r-- 1 root root 1704 Jul 12 20:13 2_blog.ppxhq.top.key</span><br></pre></td></tr></table></figure><h4 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h4><h5 id="修改conf"><a href="#修改conf" class="headerlink" title="修改conf"></a>修改conf</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-4-centos vhosts]# vim hexo.conf </span><br><span class="line">upstream hexo &#123;</span><br><span class="line">       #服务器地址和对应的端口</span><br><span class="line">       server serverIP:port;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"> server &#123;</span><br><span class="line">         listen 443 ssl;</span><br><span class="line">         server_name  blog.ppxhq.top;</span><br><span class="line">         access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;hexo.access.log;</span><br><span class="line">          error_log   &#x2F;var&#x2F;log&#x2F;nginx&#x2F;hexo.error.log;</span><br><span class="line"></span><br><span class="line">         #证书文件名称</span><br><span class="line">        ssl_certificate 1_blog.ppxhq.top_bundle.crt;</span><br><span class="line">        #私钥文件名称</span><br><span class="line">        ssl_certificate_key 2_blog.ppxhq.top.key;</span><br><span class="line">        ssl_session_timeout 5m;</span><br><span class="line">        #请按照以下协议配置</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        #请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">         proxy_buffers 16 64k;</span><br><span class="line">         proxy_buffer_size 128k;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">                proxy_pass  http:&#x2F;&#x2F;hexo&#x2F;;</span><br><span class="line">                proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;</span><br><span class="line">                proxy_redirect off;</span><br><span class="line"></span><br><span class="line">                proxy_set_header    Host            $host;</span><br><span class="line">                proxy_set_header    X-Real-IP       $remote_addr;</span><br><span class="line">                proxy_set_header    X-Forwarded-For $proxy_add_X_forwarded_for;</span><br><span class="line">                proxy_set_header    X-Forwarded-Proto http;</span><br><span class="line">                &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">#填写绑定证书的域名</span><br><span class="line">server_name blog.ppxhq.top;</span><br><span class="line">#把http的域名请求转成https</span><br><span class="line">return 301 https:&#x2F;&#x2F;$host$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="重启Nginx"><a href="#重启Nginx" class="headerlink" title="重启Nginx"></a>重启Nginx</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-4-centos vhosts]# ..&#x2F;sbin&#x2F;nginx -s reload</span><br></pre></td></tr></table></figure><p>完工，接下来就可以用<code>https</code>请求服务了，<code>http</code>请求也可以自动转为<code>https</code>。</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
          <category> SSL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
